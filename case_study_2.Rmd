---
title: "case_study_2"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r cars}
summary(cars)
```

## Including Plots

You can also embed plots, for example:

```{r pressure, echo=FALSE}
plot(pressure)
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.

## a.

```{r}
library(readr)
library(tidyr)


d343 = read.fwf(
  'rawdata_343.txt',
  skip = 2,
  strip=TRUE,
  c(8, 75-1-8, 4), 
)
d343 = d343[2:3]
colnames(d343) = c('country', 'median age')
head(d343)

d347 = read.fwf(
  'rawdata_347.txt',
  skip = 2,
  strip=TRUE,
  c(8, 73-1-8, 6),
)
d347 = d347[2:3]
colnames(d347) = c('country', 'net migration rate')
head(d347)

d373 = read.csv(
  'rawdata_373.csv',
  header = TRUE,
  strip.white=TRUE,
)
d373[,1] = trimws(d373[,1])
colnames(d373) = c('country', 'youth unemployment rate')
head(d373)
```

## b.

```{r}

merged_data = d343 %>%
  full_join(d347, by = 'country') %>%
  left_join(d373, by = 'country')

dim(merged_data)
print("Number of known values in column:")
colSums(!is.na(merged_data))
```

## c.

```{r, echo=TRUE}
library(readxl)

class_data = read_excel('OGHIST.xlsx', sheet='Country Analytical History')
col_index = which(class_data[5,] == 2020)
class_data = class_data[ , c(1, 2, col_index)]
class_data = class_data[c(11:228),]
colnames(class_data) = c('ISO 3166','country', 'status')

print("Number of known values in column:")
colSums(!is.na(class_data))
```

## d.

```{r}

extended_data = merge(merged_data, class_data, by='country')
colSums(!is.na(extended_data))
```

1.   Can be merged, but values will be lost in process. From the original 217 values it was reduced to 184 after the merge.

    ```{r}

    country_codes = read_csv(
      "Country Data Codes.csv", 
      show_col_types = FALSE
    )
    country_codes = country_codes[, c(1, 2)]
    colnames(country_codes) = c('country', 'ISO 3166')

    merged_data_w_iso = left_join(
      merged_data, 
      country_codes,
      by="country"
    ) 
    colSums(!is.na(merged_data_w_iso))

    all_data = left_join(merged_data_w_iso ,class_data, by='ISO 3166')
    colSums(!is.na(all_data))


    ```

## e.

```{r}

continent_data = read_csv("ISO-3166-Countries-with-Regional-Codes.csv", show_col_types = FALSE)
continent_data = select(continent_data, c(3,6,7))
colnames(continent_data) = c('ISO 3166', 'continent', 'region')
df_vars = left_join(all_data, continent_data, by="ISO 3166")
```

**observational units:** countries

**the variables:** median age, unermployment , net migr., income class

Variables are the characteristics or attributes measured or observed for each observational unit.

**What can be considered fixed :** Fixed variables are those that remain constant for all observational units. For example, if the dataset includes information about the continents and regions to which each country belongs, these would be considered fixed variables.

**vs measured variables:** Measured variables are those that vary across observational units.

Tidy the data if needed. needed

## g.

```{r}
status_freq <- table(df_vars$status)
status_freq
```

## h.

```{r}
absolute_freq <- table(df_vars$continent, df_vars$status)
absolute_freq

relative_freq <- prop.table(absolute_freq, margin = 1)
relative_freq
```

## i.

H: eu

L: africa

UM: Amer

## k.

```{r}
america_data = df_vars %>% filter(region %in% c('Northern America', 'Latin America and the Caribbean'))
absolute_freq_america <- table(america_data$region, america_data$status)
absolute_freq_america
```

us rich, mexico bad rawrrr

## l.

```{r}
low_middle_america <- df_vars %>%
  filter(status == "LM") %>%
  filter(region %in% c('Northern America', 'Latin America and the Caribbean'))

low_middle_america

```

prolly not. need to check

## m.

```{r}
df_vars$status <- factor(df_vars$status, levels = c("L", "LM", "UM", "H"))

df_vars$`median age` = as.numeric(df_vars$`median age`)
df_vars$`net migration rate` = as.numeric(df_vars$`net migration rate`)
df_vars$`youth unemployment rate` = as.numeric(df_vars$`youth unemployment rate`)

mean_median_age <- df_vars %>%
  group_by(status) %>%
  summarize(
    mean_median_age = mean(`median age`, na.rm = TRUE),
    avg_youth_unemployment = mean(`youth unemployment rate`, na.rm = TRUE),
    avg_net_migration = mean(`net migration rate`, na.rm = TRUE)
  )

mean_median_age

```
